<?php

/**
 * Profiles
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    RootlessMe
 * @subpackage model
 * @author     awilliams
 * @version    SVN: $Id: Builder.php 7691 2011-02-04 15:43:29Z jwage $
 */
class Profiles extends BaseProfiles
{
    public function getFullName()
    {
        $fullName = $this->getFirstName();
        if ($this->getFirstName() != null && $this->getLastName() != null)
        {
            $fullName = $fullName . " ";
        }
        $fullName = $fullName . $this->getLastName();
        return $fullName;
    }

    public function getAge()
    {

        $birth_date = $this->getBirthday();
        //Make sure the birth date is specified
        if(!$birth_date)
        {
            // If not, return null
            return null;
        }
        list($birth_year,$birth_month,$birth_day) = explode("-", $birth_date);
        $year_diff=date("Y")-$birth_year;
        $this_birthday=date("Y").$birth_month.$birth_day;
        $date=date("Ymd");

        if($this_birthday>$date){
            $year_diff--;
        }

        return $year_diff;

    }

    public function isMyFriend()
    {
        $myId = sfContext::getInstance()->getUser()->getGuardUser()->getPersonId();
        $profileId = $this->getPersonId();

        // Need sql to match this query
        // select * from friendships f
        // where f.friend1_id = 1 and f.friend2_id = 2
        //    or f.friend2_id = 1 and f.friend1_id = 2;
//        $q = $this->createQuery('f')
        $q = Doctrine_Query::create()
                ->select('profile_name')
                ->from('friendships f')
                ->where('f.friend1_id = ? AND f.friend2_id = ?', array($myId, $profileId))
                ->orWhere('f.friend2_id = ? AND f.friend1_id = ?', array($myId, $profileId));

        // Return a boolean indicating whether there was a friendship
        // record found.
        return ($q->count() > 0) ;
    }
}